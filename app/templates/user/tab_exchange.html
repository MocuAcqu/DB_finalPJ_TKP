{% if current_user.is_authenticated %}
    <div class="contact-methods" style="margin-top: 10px;"></div>
{% else %}
    <div class="login-alert">
        <a href="{{ url_for('auth.login') }}">ç™»å…¥</a> å¾Œå¯æŸ¥çœ‹è©³æƒ…
    </div>
{% endif %}
<div class="items-grid"
     style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px;">
    {% if items %}
        {% for item in items %}
            {% set seller = seller_map.get(item.seller_id) %}




            <div class="item-card">
                <div class="item-image">
                    <img src="{{ url_for('main.get_image', image_id=item.image_id) }}"
                         alt="{{ item.name }}">
                </div>

                <div class="item-details" style="padding: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                        <h3 style="margin: 0; font-size: 1.1em; color: #333;">{{ item.name }}</h3>
                    </div>

                    <div class="tags" style="margin-bottom: 10px;">
                        {% for tag in item.tags %}
                            <span style="background: #f0f0f0; color: #666; padding: 2px 6px;
                                         border-radius: 4px; font-size: 0.8em;">
                                #{{ tag }}
                            </span>
                        {% endfor %}
                    </div>
                    <p class="description">
                        {{ item.description }}
                    </p>

                    <strong style="color: #1913b5; display:block; margin-bottom: 15px;">
                        æƒ³æ›ï¼š{{ item.exchange_want }}
                    </strong>


                    <hr style="border: 0; border-top: 1px solid #eee; margin: 10px 0;">

                    <div class="seller-info" style="font-size: 0.9em;">
                        <div style="display: flex; align-items: center; margin-bottom: 5px;">
                            <span style="font-weight: bold; margin-right: 5px;">
                                æä¾›è€…: {{ seller.username if seller else 'æœªçŸ¥' }}
                            </span>
                        </div>
                        <div class="item-actions">
                            <button 
                                type="button"
                                class="view-detail-btn"
                                data-item-id="{{ item.id }}">
                                <span class="icon">ğŸ’¬</span> æŸ¥çœ‹è©³æƒ…
                            </button>
                        </div>

                    </div>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <div style="grid-column: 1/-1; text-align: center; padding: 50px; color: #888;">
            <p>ç›®å‰æ²’æœ‰ç›¸é—œç‰©å“ï¼Œæ™šé»å†ä¾†çœ‹çœ‹å§ï¼</p>
        </div>
    {% endif %}
</div>
<div id="detail-modal" class="detail-modal">
    <div class="modal-content">
        <button class="modal-close" id="detail-modal-close">âœ•</button>
         <!--  A. å•†å“è³‡è¨Š -->
        <h2 id="detail-title"></h2>

        <div id="detail-tags" class="tags"></div>

        <p>æä¾›è€…ï¼š<span id="detail-seller"></span></p>

        <img id="detail-image" class="detail-image">

        <h4>ç‰©å“æè¿°</h4>
        <p id="detail-description"></p>
        <!-- B. å…¬é–‹ç•™è¨€å€ -->
        <div id="detail-extra"></div>
        <div class="comment-section">
            <h3 class="comment-title">ğŸ’¬ ç•™è¨€</h3>
            <div id="exchange-message-list" class="comment-list"></div>

            <div class="comment-input">
                <textarea id="exchange-message-text" placeholder="è¼¸å…¥ç•™è¨€..."></textarea>
                <button id="exchange-message-submit">é€å‡º</button>
            </div>
        </div>
        <!-- C. æå‡ºäº¤æ›è«‹æ±‚ -->
        <div class="exchange-section">
            <h3 class="exchange-title"> äº¤æ›è«‹æ±‚</h3>
            <p class="exchange-hint">å¾ã€Œæˆ‘çš„ç‰©å“ã€ä¸­é¸ä¸€ä»¶æå‡ºäº¤æ›ï¼š</p>

            <!-- é€™è£¡æœƒç”± JS å¡«å…¥ä½¿ç”¨è€…è‡ªå·±çš„ç‰©å“ -->
            <div id="exchange-item-list" class="exchange-item-list"></div>

            <button id="exchange-submit-btn" class="exchange-submit-btn" disabled>
                é€å‡ºäº¤æ›è«‹æ±‚
            </button>
        </div>
    </div>



</div>

