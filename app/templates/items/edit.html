{% extends 'layouts/base.html' %}

{% block content %}
<div class="upload-container" style="max-width: 800px; margin: 2rem auto; padding: 2rem; background: #fff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h2>編輯物品</h2>
        <img src="{{ url_for('main.get_image', image_id=item.image_id) }}" alt="Current Image" style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; border: 1px solid #ddd;">
    </div>
    <hr>
    
    <form action="{{ url_for('main.edit_item', item_id=item.id) }}" method="POST" enctype="multipart/form-data">
        
        <div class="form-group">
            <label for="name">商品名稱 <span style="color:red;">*</span></label>
            <input type="text" id="name" name="name" value="{{ item.name }}" required class="form-control">
        </div>

        <div class="form-group">
            <label for="image">更換圖片 (若不更換請留空)</label>
            <input type="file" id="image" name="image" accept="image/*" class="form-control">
        </div>

        <div class="form-group">
            <label for="description">商品敘述</label>
            <textarea id="description" name="description" rows="5" class="form-control">{{ item.description }}</textarea>
        </div>

        <div class="form-group">
            <label for="tags">商品關鍵字 (Tags)</label>
            <input type="text" id="tags" name="tags" value="{{ item.tags|join(', ') }}" class="form-control">
        </div>

        <div class="form-group">
            <label>交易方式 <span style="color:red;">*</span></label>
            <div class="radio-group" style="margin-top: 5px;">
                <label style="margin-right: 15px;">
                    <input type="radio" name="transaction_type" value="sell" {% if item.transaction_type == 'sell' %}checked{% endif %} onchange="toggleFields()"> 買賣 (出售)
                </label>
                <label style="margin-right: 15px;">
                    <input type="radio" name="transaction_type" value="rent" {% if item.transaction_type == 'rent' %}checked{% endif %} onchange="toggleFields()"> 租借
                </label>
                <label>
                    <input type="radio" name="transaction_type" value="exchange" {% if item.transaction_type == 'exchange' %}checked{% endif %} onchange="toggleFields()"> 交換
                </label>
            </div>
        </div>

        <div class="form-group" id="price-field">
            <label for="price">價格 (TWD)</label>
            <input type="number" id="price" name="price" value="{{ item.price }}" class="form-control">
        </div>

        <div class="form-group" id="exchange-field" style="display: none;">
            <label for="exchange_want">想換的東西關鍵字</label>
            <input type="text" id="exchange_want" name="exchange_want" value="{{ item.exchange_want }}" class="form-control">
        </div>

        <div style="margin-top: 30px;">
            <button type="submit" style="background-color: #2196F3; color: white; padding: 12px 24px; border: none; border-radius: 4px; cursor: pointer; font-size: 1.1rem;">
                儲存變更
            </button>
            <a href="{{ url_for('main.index', role='seller', tab='items') }}" style="margin-left: 15px; color: #666; text-decoration: none;">取消</a>
        </div>
    </form>
</div>

<script>
    function toggleFields() {
        const type = document.querySelector('input[name="transaction_type"]:checked').value;
        const priceField = document.getElementById('price-field');
        const exchangeField = document.getElementById('exchange-field');
        const priceInput = document.getElementById('price');
        const exchangeInput = document.getElementById('exchange_want');

        if (type === 'exchange') {
            priceField.style.display = 'none';
            exchangeField.style.display = 'block';
            priceInput.required = false;
            exchangeInput.required = true;
        } else {
            priceField.style.display = 'block';
            exchangeField.style.display = 'none';
            priceInput.required = true;
            exchangeInput.required = false;
        }
    }
    // 初始化頁面時執行一次，確保欄位顯示正確
    window.onload = toggleFields;
</script>

<style>
    .form-group { margin-bottom: 20px; }
    .form-control { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
    label { font-weight: bold; display: block; margin-bottom: 5px; }
</style>
{% endblock %}