<div style="max-width: 850px; margin: 2rem auto;">
    <h2 style="margin-bottom: 1rem;">管理回應專區</h2>

    {# =================== A. 買賣 / 租借：表達興趣 =================== #}
    <h3 style="margin: 1rem 0;">買賣 / 租借 - 表達興趣列表</h3>

    <!-- 類型 tab bar -->
    <div class="tab-bar-container">
        <div class="tab-bar responses-tab-bar">
            <a class="tab-item active" data-type="all">
                All
            </a>
            <a class="tab-item" data-type="sell">
                買賣
            </a>
            <a class="tab-item" data-type="rent">
                租借
            </a>
        </div>
    </div>

    <!-- 狀態篩選 -->
    <div class="status-filter responses-status-filter"
         style="display:flex; gap:12px; margin:15px 0;">
        <button class="status-btn active" data-status="all">全部</button>
        <button class="status-btn" data-status="pending">待回應</button>
        <button class="status-btn" data-status="contacted">已聯絡</button>
        <button class="status-btn" data-status="done">已完成</button>
    </div>

    {% if interests and interests|length > 0 %}
        <table style="width: 100%; border-collapse: collapse; background: #fff;
                      box-shadow: 0 2px 8px rgba(0,0,0,0.05); border-radius: 6px; overflow: hidden;">
            <thead style="background:#f5f5f5;">
                <tr>
                    <th style="padding:10px; text-align:left;">物品</th>
                    <th style="padding:10px; text-align:left;">買家</th>
                    <th style="padding:10px; text-align:left;">類型</th>
                    <th style="padding:10px; text-align:left;">狀態</th>
                    <th style="padding:10px; text-align:left;">時間</th>
                </tr>
            </thead>
            <tbody>
                {% for r in interests %}
                <tr class="interest-row"
                    data-type="{{ r.type or 'unknown' }}"
                    data-status="{{ r.status or 'pending' }}">
                    <td style="padding:10px;">
                        {{ r.item.name if r.item else "(物品已刪除)" }}
                    </td>
                    <td style="padding:10px;">
                        {{ r.buyer.username if r.buyer else "(使用者已刪除)" }}
                    </td>
                    <td style="padding:10px;">
                        {% if r.type == "sell" %}買賣
                        {% elif r.type == "rent" %}租借
                        {% else %}交換{% endif %}
                    </td>
                    <td style="padding:10px;">
                        <select class="status-dropdown"
                                data-id="{{ r.id }}"
                                style="padding:6px 8px; border-radius:6px; border:1px solid #ccc;">

                            <option value="pending"   {% if r.status == "pending" %}selected{% endif %}>待回應</option>
                            <option value="contacted" {% if r.status == "contacted" %}selected{% endif %}>已聯絡</option>
                            <option value="done"      {% if r.status == "done" %}selected{% endif %}>已完成</option>

                        </select>
                    </td>

                    <td style="padding:10px; color:#888; font-size:0.9em;">
                        {{ r.created_at.strftime("%Y-%m-%d %H:%M") if r.created_at else "-" }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div style="padding: 20px; text-align:center; background:#fff; border-radius:8px;
                    box-shadow:0 2px 10px rgba(0,0,0,0.05); color:#777;">
            目前還沒有任何買賣 / 租借的表達興趣。
        </div>
    {% endif %}

    {# =================== B. 交換請求列表 =================== #}
    <h3 style="margin: 2rem 0 1rem;">交換請求列表</h3>

    {% if exchange_requests and exchange_requests|length > 0 %}
        <table style="width: 100%; border-collapse: collapse; background: #fff;
                      box-shadow: 0 2px 8px rgba(0,0,0,0.05); border-radius: 6px; overflow: hidden;">
            <thead style="background:#f5f5f5;">
                <tr>
                    <th style="padding:10px; text-align:left;">你的物品</th>
                    <th style="padding:10px; text-align:left;">提出者 / 提供的物品</th>
                    <th style="padding:10px; text-align:left;">狀態</th>
                    <th style="padding:10px; text-align:left;">時間</th>
                    <th style="padding:10px; text-align:left;">留言</th>
                </tr>
            </thead>
            <tbody>
                {% for ex in exchange_requests %}
                <tr>
                    <td style="padding:10px;">
                        {{ ex.target_item.name if ex.target_item else "(物品已刪除)" }}
                    </td>
                    <td style="padding:10px;">
                        <div>
                            {{ ex.proposer.username if ex.proposer else "(使用者已刪除)" }}
                        </div>
                        <div style="font-size:0.85em; color:#666; margin-top:4px;">
                            提供物品：
                            {% if ex.offered_items %}
                                {% for oi in ex.offered_items %}
                                    {% if oi %}
                                        {{ oi.name }}{% if not loop.last %}、{% endif %}
                                    {% else %}
                                        (物品已刪除)
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                (無資料)
                            {% endif %}
                        </div>
                    </td>
                    <td style="padding:10px;">
                        {% if ex.status == "pending" %}
                            待回應
                        {% elif ex.status == "accepted" %}
                            已接受
                        {% elif ex.status == "rejected" %}
                            已拒絕
                        {% else %}
                            {{ ex.status }}
                        {% endif %}
                    </td>
                    <td style="padding:10px; color:#888; font-size:0.9em;">
                        {{ ex.created_at.strftime("%Y-%m-%d %H:%M") if ex.created_at else "-" }}
                    </td>
                    <td style="padding:10px;">
                        {% if ex.target_item_id %}
                        <button type="button"
                                class="view-detail-btn"
                                data-item-id="{{ ex.target_item_id }}"
                                style="padding:6px 10px; border-radius:4px; border:1px solid #ccc;
                                       background:#f8f9fa; cursor:pointer; font-size:0.85em;">
                            查看商品與留言
                        </button>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div style="padding: 20px; text-align:center; background:#fff; border-radius:8px;
                    box-shadow:0 2px 10px rgba(0,0,0,0.05); color:#777;">
            目前還沒有任何交換請求。
        </div>
    {% endif %}
</div>
