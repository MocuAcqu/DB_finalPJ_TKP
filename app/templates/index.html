{% extends 'layouts/base.html' %}

{% block content %}
<div class="content-area">
    <div class="tab-bar-container">
        <div class="tab-bar">
            {% if role == 'user' %}
                <a href="{{ url_for('main.index', role='user', tab='exchange') }}" class="tab-item {% if active_tab == 'exchange' %}active{% endif %}">
                    物品交換
                </a>
                <a href="{{ url_for('main.index', role='user', tab='buy_sell') }}" class="tab-item {% if active_tab == 'buy_sell' %}active{% endif %}">
                    買賣專區
                </a>
                <a href="{{ url_for('main.index', role='user', tab='rent') }}" class="tab-item {% if active_tab == 'rent' %}active{% endif %}">
                    租借專區
                </a>
                <a href="{{ url_for('main.index', role='user', tab='profile') }}" class="tab-item {% if active_tab == 'profile' %}active{% endif %}">
                    個人資料
                </a>
                <a href="{{ url_for('main.index', role='user', tab='notifications') }}" class="tab-item {% if active_tab == 'notifications' %}active{% endif %}">
                    通知
                </a>
            {% elif role == 'seller' %}
                <a href="{{ url_for('main.index', role='seller', tab='items') }}" class="tab-item {% if active_tab == 'items' %}active{% endif %}">
                    我的物品
                </a>
                <a href="{{ url_for('main.index', role='seller', tab='responses') }}" class="tab-item {% if active_tab == 'responses' %}active{% endif %}">
                    管理回應
                </a>
                <a href="{{ url_for('main.index', role='seller', tab='profile') }}" class="tab-item {% if active_tab == 'profile' %}active{% endif %}">
                    個人資料
                </a>
            {% endif %}
        </div>
    </div>
    
    {% if active_tab in ['exchange', 'buy_sell', 'rent', 'items'] %}
        {% include 'partials/_search_block.html' %}
    {% endif %}

    <div class="page-content">
        {% if role == 'user' %} 
            {% if active_tab == 'exchange' %}
                {% include 'user/tab_exchange.html' %}
            {% elif active_tab == 'buy_sell' %}
                {% include 'user/tab_buy_sell.html' %}
            {% elif active_tab == 'rent' %}
                {% include 'user/tab_rent.html' %}
            {% elif active_tab == 'profile' %}
                {% include 'user/tab_profile.html' %}
            {% elif active_tab == 'notifications' %}
                {% include 'user/tab_notifications.html' %}
            
            {% endif %}

        {% elif role == 'seller' %}
            {% if active_tab == 'items' %}
                {% include 'seller/tab_items.html' %}
            {% elif active_tab == 'responses' %}
                {% include 'seller/tab_responses.html' %}
            {% elif active_tab == 'profile' %}
                {% include 'seller/tab_profile.html' %}
            {% endif %}
        {% endif %}

        {% if total_pages > 1 and active_tab in ['exchange', 'buy_sell', 'rent', 'items'] %}
        <div class="pagination-container" style="text-align: center; margin-top: 40px; margin-bottom: 20px;">
            {% if page > 1 %}
                <a href="{{ url_for('main.index', role=role, tab=active_tab, q=search_query, sort=sort_order, page=page-1) }}" 
                   style="display: inline-block; padding: 8px 14px; margin: 0 4px; border: 1px solid #ddd; border-radius: 4px; text-decoration: none; color: #555; background: #fff;">
                   &laquo; 上一頁
                </a>
            {% endif %}

            {% for p in range(1, total_pages + 1) %}
                <a href="{{ url_for('main.index', role=role, tab=active_tab, q=search_query, sort=sort_order, page=p) }}" 
                   class="pagination-link {{ 'active' if p == page else '' }}">
                    {{ p }}
                </a>
            {% endfor %}

            {% if page < total_pages %}
                <a href="{{ url_for('main.index', role=role, tab=active_tab, q=search_query, sort=sort_order, page=page+1) }}" 
                   style="display: inline-block; padding: 8px 14px; margin: 0 4px; border: 1px solid #ddd; border-radius: 4px; text-decoration: none; color: #555; background: #fff;">
                   下一頁 &raquo;
                </a>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}